<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ink Spill Game</title>
  <style>
    body {
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    .game-area {
      position: relative;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 20px;
    }
    canvas {
      border: 2px solid #333;
      max-width: 100%;
      max-height: 100%;
    }
    #flashOverlay {
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      pointer-events: none;
    }
    .swatches {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
    }
    .swatch {
      width: 40px;
      height: 40px;
      border: 2px solid #333;
      cursor: pointer;
      border-radius: 6px;
      transition: transform 0.2s;
    }
    .swatch:hover {
      transform: scale(1.1);
    }
    #message {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    #resetBtn, #settingsBtn {
      margin-top: 10px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #333;
      color: white;
    }
    #resetBtn { display: none; }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      max-width: 90%;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .modal-content label {
      display: block;
      margin-top: 10px;
    }
    .modal-content select, .modal-content button {
      margin-top: 5px;
      width: 100%;
      padding: 6px;
    }
  </style>
</head>
<body>
  <h1>Ink Spill Game</h1>
  <div class="game-area">
    <canvas id="gameCanvas"></canvas>
    <canvas id="lifeCanvas"></canvas>
    <canvas id="flashOverlay"></canvas>
  </div>
  <div class="swatches" id="swatchContainer"></div>
  <div id="message"></div>
  <button id="settingsBtn">Settings ⚙️</button>
  <button id="resetBtn">Play Again</button>

  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <h2>Game Settings</h2>
      <label>
        Difficulty:
        <select id="difficulty">
          <option value="easy">Easy (50 lives)</option>
          <option value="medium" selected>Medium (30 lives)</option>
          <option value="hard">Hard (20 lives)</option>
        </select>
      </label>
      <label>
        Board Size:
        <select id="boardSize">
          <option value="10">10 x 10</option>
          <option value="14" selected>14 x 14</option>
          <option value="20">20 x 20</option>
        </select>
      </label>
      <label>
        Color Scheme:
        <select id="colorScheme">
          <option value="classic" selected>Classic (6 colors)</option>
          <option value="warm">Warm (reds/oranges)</option>
          <option value="cool">Cool (blues/greens)</option>
        </select>
      </label>
      <button id="applySettings">Apply & Start</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const lifeCanvas = document.getElementById('lifeCanvas');
    const lifeCtx = lifeCanvas.getContext('2d');
    const flashCanvas = document.getElementById('flashOverlay');
    const flashCtx = flashCanvas.getContext('2d');

    const messageEl = document.getElementById('message');
    const resetBtn = document.getElementById('resetBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const modal = document.getElementById('settingsModal');
    const applyBtn = document.getElementById('applySettings');

    const difficultyEl = document.getElementById('difficulty');
    const boardSizeEl = document.getElementById('boardSize');
    const colorSchemeEl = document.getElementById('colorScheme');

    const colorSchemes = {
      classic: ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'],
      warm: ['#FF0000', '#FF4500', '#FF8C00', '#FFD700', '#FF6347', '#FF1493'],
      cool: ['#0000FF', '#1E90FF', '#00CED1', '#20B2AA', '#3CB371', '#00FF7F']
    };

    const BASE_WIDTH = 400;
    const BASE_HEIGHT = 400;
    const BASE_LIFE_WIDTH = 50;
    let scale = 1;

    let config = {
      gridSize: 14,
      cellSize: BASE_WIDTH / 14,
      colors: colorSchemes.classic,
      maxLives: 30
    };

    let gameState;

    function resizeCanvases() {
      const aspectRatio = BASE_WIDTH / BASE_HEIGHT;
      let width = window.innerWidth * 0.8;
      let height = window.innerHeight * 0.8;

      if (width / height > aspectRatio) {
        width = height * aspectRatio;
      } else {
        height = width / aspectRatio;
      }

      scale = width / BASE_WIDTH;
      canvas.width = width;
      canvas.height = height;
      lifeCanvas.width = BASE_LIFE_WIDTH * scale;
      lifeCanvas.height = height;
      flashCanvas.width = width;
      flashCanvas.height = height;

      config.cellSize = canvas.width / config.gridSize;

      // Scale UI elements
      document.querySelector('h1').style.fontSize = `${36 * scale}px`;
      document.querySelector('.game-area').style.gap = `${20 * scale}px`;
      document.querySelector('.swatches').style.marginTop = `${20 * scale}px`;
      document.querySelector('.swatches').style.gap = `${10 * scale}px`;
      document.querySelectorAll('.swatch').forEach(swatch => {
        swatch.style.width = `${40 * scale}px`;
        swatch.style.height = `${40 * scale}px`;
        swatch.style.borderRadius = `${6 * scale}px`;
      });
      messageEl.style.fontSize = `${18 * scale}px`;
      messageEl.style.marginTop = `${20 * scale}px`;
      resetBtn.style.fontSize = `${16 * scale}px`;
      resetBtn.style.padding = `${8 * scale}px ${16 * scale}px`;
      resetBtn.style.marginTop = `${10 * scale}px`;
      settingsBtn.style.fontSize = `${16 * scale}px`;
      settingsBtn.style.padding = `${8 * scale}px ${16 * scale}px`;
      settingsBtn.style.marginTop = `${10 * scale}px`;
      document.querySelector('.modal-content').style.padding = `${20 * scale}px`;
      document.querySelector('.modal-content').style.borderRadius = `${10 * scale}px`;
      document.querySelector('.modal-content').style.width = `${300 * scale}px`;
      document.querySelector('.modal-content h2').style.fontSize = `${24 * scale}px`;
      document.querySelectorAll('.modal-content label').forEach(label => {
        label.style.marginTop = `${10 * scale}px`;
      });
      document.querySelectorAll('.modal-content select, .modal-content button').forEach(el => {
        el.style.marginTop = `${5 * scale}px`;
        el.style.padding = `${6 * scale}px`;
        el.style.fontSize = `${16 * scale}px`;
      });

      drawGrid();
      drawLifeBar();
      createSwatches();
    }

    function resetGame() {
      gameState = {
        grid: [],
        moves: 0,
        lives: config.maxLives,
        isGameActive: true
      };
      messageEl.textContent = '';
      resetBtn.style.display = 'none';
      initializeGrid();
      drawGrid();
      drawLifeBar();
      createSwatches();
    }

    function initializeGrid() {
      config.cellSize = canvas.width / config.gridSize;
      for (let row = 0; row < config.gridSize; row++) {
        gameState.grid[row] = [];
        for (let col = 0; col < config.gridSize; col++) {
          const randomColorIndex = Math.floor(Math.random() * config.colors.length);
          gameState.grid[row][col] = config.colors[randomColorIndex];
        }
      }
    }

    function drawGrid() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let row = 0; row < config.gridSize; row++) {
        for (let col = 0; col < config.gridSize; col++) {
          const x = col * config.cellSize;
          const y = row * config.cellSize;
          ctx.fillStyle = gameState.grid[row][col];
          ctx.fillRect(x, y, config.cellSize, config.cellSize);
        }
      }
    }

    function drawLifeBar() {
      const barWidth = lifeCanvas.width - 10 * scale;
      const barHeight = lifeCanvas.height - 20 * scale;
      lifeCtx.clearRect(0, 0, lifeCanvas.width, lifeCanvas.height);

      lifeCtx.strokeStyle = '#333';
      lifeCtx.lineWidth = 2 * scale;
      lifeCtx.strokeRect(5 * scale, 10 * scale, barWidth, barHeight);

      const remainingRatio = gameState.lives / config.maxLives;
      const filledHeight = barHeight * remainingRatio;
      const yStart = 10 * scale + (barHeight - filledHeight);

      const gradient = lifeCtx.createLinearGradient(0, 10 * scale, 0, lifeCanvas.height - 10 * scale);
      gradient.addColorStop(0, '#00FF00');
      gradient.addColorStop(1, '#FF0000');

      lifeCtx.fillStyle = gradient;
      lifeCtx.fillRect(5 * scale, yStart, barWidth, filledHeight);

      lifeCtx.fillStyle = '#000';
      lifeCtx.font = `${16 * scale}px Arial`;
      lifeCtx.fillText(`${gameState.lives}/${config.maxLives}`, 5 * scale, lifeCanvas.height - 5 * scale);
    }

    function floodFill(row, col, targetColor, replacementColor) {
      if (targetColor === replacementColor) return;
      const stack = [[row, col]];
      while (stack.length > 0) {
        const [r, c] = stack.pop();
        if (
          r >= 0 && r < config.gridSize &&
          c >= 0 && c < config.gridSize &&
          gameState.grid[r][c] === targetColor
        ) {
          gameState.grid[r][c] = replacementColor;
          stack.push([r + 1, c], [r - 1, c], [r, c + 1], [r, c - 1]);
        }
      }
    }

    function checkWin() {
      const firstColor = gameState.grid[0][0];
      for (let row = 0; row < config.gridSize; row++) {
        for (let col = 0; col < config.gridSize; col++) {
          if (gameState.grid[row][col] !== firstColor) {
            return false;
          }
        }
      }
      return true;
    }

    function flashScreen(color, callback) {
      flashCtx.clearRect(0, 0, flashCanvas.width, flashCanvas.height);
      flashCtx.fillStyle = color;
      flashCtx.fillRect(0, 0, flashCanvas.width, flashCanvas.height);
      flashCanvas.style.opacity = 1;
      let opacity = 1;
      const fade = setInterval(() => {
        opacity -= 0.05;
        flashCanvas.style.opacity = opacity;
        if (opacity <= 0) {
          clearInterval(fade);
          if (callback) callback();
        }
      }, 30);
    }

    function handleSwatchClick(color) {
      if (!gameState.isGameActive) return;
      const startColor = gameState.grid[0][0];
      if (color !== startColor) {
        floodFill(0, 0, startColor, color);
        gameState.moves++;
        gameState.lives--;
        drawGrid();
        drawLifeBar();

        if (checkWin()) {
          gameState.isGameActive = false;
          flashScreen('white', () => {
            messageEl.textContent = `You win in ${gameState.moves} moves! 🎉`;
            resetBtn.style.display = 'inline-block';
          });
        } else if (gameState.lives <= 0) {
          gameState.isGameActive = false;
          flashScreen('black', () => {
            messageEl.textContent = 'You lose! 💀 Out of lives.';
            resetBtn.style.display = 'inline-block';
          });
        }
      }
    }

    function createSwatches() {
      const container = document.getElementById('swatchContainer');
      container.innerHTML = '';
      config.colors.forEach(color => {
        const swatch = document.createElement('div');
        swatch.classList.add('swatch');
        swatch.style.backgroundColor = color;
        swatch.style.width = `${40 * scale}px`;
        swatch.style.height = `${40 * scale}px`;
        swatch.style.borderRadius = `${6 * scale}px`;
        swatch.addEventListener('click', () => handleSwatchClick(color));
        container.appendChild(swatch);
      });
    }

    // Modal logic
    settingsBtn.addEventListener('click', () => {
      modal.style.display = 'flex';
    });

    applyBtn.addEventListener('click', () => {
      const difficulty = difficultyEl.value;
      if (difficulty === 'easy') config.maxLives = 50;
      if (difficulty === 'medium') config.maxLives = 30;
      if (difficulty === 'hard') config.maxLives = 20;

      config.gridSize = parseInt(boardSizeEl.value);
      config.colors = colorSchemes[colorSchemeEl.value];

      modal.style.display = 'none';
      resetGame();
      resizeCanvases();
    });

    resetBtn.addEventListener('click', resetGame);

    // Resize event listener
    window.addEventListener('resize', resizeCanvases);

    // Initialize with modal open
    modal.style.display = 'flex';
    resizeCanvases();
  </script>
</body>
</html>